apiVersion: batch/v1
kind: Job
metadata:
  labels: { }
  annotations: { }
  name: f3-submission
spec:
  template:
    spec:
      # https://kubernetes.io/docs/concepts/workloads/controllers/job/#handling-pod-and-container-failures
      # https://kubernetes.io/docs/concepts/workloads/controllers/job/#pod-backoff-failure-policy
      activeDeadlineSeconds: 7200
      restartPolicy: Never
      containers:
        - env:
            - name: AICROWD_TESTS_FOLDER
              value: /tmp
          image:
          pullPolicy: Always
          name: f3-submission
          volumeMounts:
            - mountPath: /tmp
              name: environments
      initContainers:
        - args:
            - -c
            - unzip /tmp/environments.zip -d /tmp/environments
          command:
            - /bin/sh
          image: busybox
          imagePullPolicy: IfNotPresent
          name: startup
          volumeMounts:
            - mountPath: /tmp/environments.zip
              name: fab-flatland3-submission-data-vol
              subPath: environments.zip
            - mountPath: /tmp/environments
              name: environments
      volumes:
        - configMap:
            name: fab-flatland3-submission-data
          name: fab-flatland3-submission-data-vol
        - emptyDir: { }
          name: environments
